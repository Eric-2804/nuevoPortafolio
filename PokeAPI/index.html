<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokémon Card</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="card">
        <div class="card-content">
            <div class="left">
                <img id="pokemon-image" src="" alt="Pokémon" />
            </div>
            <div class="right">
                <h2 id="pokemon-name">Loading...</h2>
                <div class="info" id="pokemon-id"></div>
                <div class="types" id="pokemon-types"></div>
                <div class="weaknesses" id="pokemon-weaknesses"></div>
                <div class="stats" id="pokemon-stats"></div>
            </div>
        </div>
    </div>

    <script>
        async function getRandomPokemon() {
            const maxPokemon = 1010; // cantidad aproximada actual
            const randomId = Math.floor(Math.random() * maxPokemon) + 1;
            const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${randomId}`);
            const data = await res.json();

            document.getElementById("pokemon-image").src = data.sprites.other["official-artwork"].front_default;
            document.getElementById("pokemon-name").textContent = data.name.toUpperCase();
            document.getElementById("pokemon-id").textContent = `#${data.id}`;

            // Tipos
            const typesContainer = document.getElementById("pokemon-types");
            typesContainer.innerHTML = "";
            data.types.forEach(t => {
                const tag = document.createElement("div");
                tag.className = "tag";
                tag.textContent = t.type.name.toUpperCase();
                typesContainer.appendChild(tag);
            });

            // Stats
            const statsContainer = document.getElementById("pokemon-stats");
            statsContainer.innerHTML = "";
            data.stats.forEach(stat => {
                const statDiv = document.createElement("div");
                statDiv.className = "stat";
                statDiv.innerHTML = `
          <span>${stat.stat.name.toUpperCase()}: ${stat.base_stat}</span>
          <div class="bar">
            <div class="bar-fill" style="width: ${Math.min(stat.base_stat, 100)}%;"></div>
          </div>
        `;
                statsContainer.appendChild(statDiv);
            });

            // Debilidades (requiere obtener los tipos)
            const weaknessesContainer = document.getElementById("pokemon-weaknesses");
            weaknessesContainer.innerHTML = "";

            // Obtener daños por tipo
            const typeUrls = data.types.map(t => t.type.url);
            const typeData = await Promise.all(typeUrls.map(url => fetch(url).then(r => r.json())));

            const damageRelations = typeData.flatMap(type => type.damage_relations.double_damage_from);
            const uniqueWeaknesses = [...new Set(damageRelations.map(d => d.name))];

            uniqueWeaknesses.forEach(w => {
                const tag = document.createElement("div");
                tag.className = "tag";
                tag.textContent = w.toUpperCase();
                weaknessesContainer.appendChild(tag);
            });
        }

        window.onload = getRandomPokemon;
    </script>
</body>

</html>